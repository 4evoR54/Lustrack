- name: Get list of repositories
  id: repos
  run: |
    OWNER="your-organization-or-username"  # Set this manually if needed
    echo "Fetching repositories that start with 'Lustra'..."

    REPO_LIST=""
    PAGE=1
    while true; do
      RESPONSE=$(curl -s -H "Authorization: token ${{ secrets.GITHUB_TOKEN }}" \
        "https://api.github.com/orgs/$OWNER/repos?per_page=100&page=$PAGE")

      # Check if the response contains an error
      ERROR_MESSAGE=$(echo "$RESPONSE" | jq -r '.message')
      if [ "$ERROR_MESSAGE" != "null" ]; then
        echo "Error fetching repositories: $ERROR_MESSAGE"
        exit 1
      fi

      REPO_NAMES=$(echo "$RESPONSE" | jq -r '.[] | select(.name | startswith("Lustra")) | .name')

      if [ -z "$REPO_NAMES" ]; then
        break
      fi

      REPO_LIST="$REPO_LIST $REPO_NAMES"
      PAGE=$((PAGE + 1))
    done

    echo "Repositories found: $REPO_LIST"
    echo "::set-output name=repo_list::$REPO_LIST"
